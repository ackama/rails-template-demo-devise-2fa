<h1>Manage my MFA</h1>

<div class="alert alert-info" role="alert">
  <pre>
  What jargon makes the most sense to users?
    Manage my MFA
    Manage my Multi-factor authentiation
    Manage my second factor
    Manage my 2FA
  </pre>
</div>

<table class="table table-bordered table-sm">
  <tr>
    <td>MFA status</td>
    <td>
      <% if current_user.otp_enabled_and_required? %>
        <span class="badge bg-success">
          Enabled
        </span>
      <% else %>
        <span class="badge bg-danger">
          Disabled
        </span>
      <% end %>
    </td>
  </tr>
  <tr>
    <td>Backup codes</td>
    <td>
      <% if current_user.otp_backup_codes.present? %>
        <span class="badge bg-success">
          Enabled
        </span>
      <% else %>
        <span class="badge bg-danger">
          Disabled
        </span>
      <% end %>
    </td>
  </tr>
</table>


<% if current_user.otp_enabled_and_required? %>
  <div class="row">
    <div class="col-sm-3">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Reset MFA</h5>
          <div class="card-text">
            Your OTP secret will be immediately deleted so the codes generated by your Authenticator app will no longer work.
          </div>
          <div class="card-text mt-3">
            <strong>You must complete the setup of an Authenticator app on the next page or you will not be able to sign in again</strong>
          </div>
          <% if current_user.otp_backup_codes.present? %>
            <div class="card-text mt-3">
              Your backup codes will NOT be affected by this change.
            </div>
          <% end %>
        </div>
        <div class="card-body">
          <%= button_to "Reset my MFA ", edit_users_mfa_path, class: "btn btn-danger", method: :get %>
        </div>
      </div>

    </div>
    <div class="col-sm-3">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Disable MFA</h5>
          <div class="card-text">
            MFA will be immediately disabled on your account. The codes generated by your Authenticator app will no longer work. You can enable MFA later but you will need to scan a new QR code for your Authenticator app.
          </div>
        </div>
        <div class="card-body">
          <%= link_to "Disable MFA", users_mfa_path, method: :delete, class: "btn btn-danger" %>
        </div>
      </div>

    </div>
  </div>
<% else %>
  <div class="row">
    <div class="col-sm-3">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Enable MFA</h5>
          <div class="card-text">
            Once you complete the set up on the next screen, you will be REQUIRED to use an OTP code to sign in.
          </div>
        </div>
        <div class="card-body">
          <%= button_to "Enable MFA", new_users_mfa_path, method: :get, class: "btn btn-primary" %>
        </div>
      </div>

    </div>
  </div>
<% end %>

<h2 class="my-3">Manage backup codes</h2>

<% if current_user.otp_backup_codes.present? %>
  <div class="row">
    <div class="col-sm-3">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Reset my backup codes</h5>
          <div class="card-text">
            Your existing backup codes will be immediately useless.
          </div>
          <div class="card-text mt-3">
            You must copy the new codes you see on the next screen. <strong>They can never be shown to you again</strong> because they are stored encrypted.
          </div>
        </div>
        <div class="card-body">
          <%= button_to "Reset backup codes", reset_backup_codes_users_mfa_path, class: "btn btn-danger", method: :get %>
        </div>
      </div>

    </div>
    <div class="col-sm-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Delete my backup codes</h5>
          <div class="card-text">
            Your backup codes will be immediately useless. There is no undo.
          </div>
        </div>
        <div class="card-body">
          <%= button_to "Delete my backup codes", delete_backup_codes_users_mfa_path, class: "btn btn-danger", method: :delete %>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <div class="row">
    <div class="col-sm-3">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Generate new backup codes</h5>
          <div class="card-text">
            If you lose your Authenticator device,
            you can use these codes instead of the 6-digit TOTP code from the device.
          </div>
          <div class="card-text mt-3">
            <strong>Each code can only be used once.</strong>
            Keep them in a safe place.
          </div>
        </div>
        <div class="card-body">
          <%= button_to "Create backup codes", reset_backup_codes_users_mfa_path, class: "btn btn-primary", method: :post %>
        </div>
      </div>
    </div>
  </div>
<% end %>
